{{
        File:     game.spin
        Author:   Connor Spangler
        Date:     11/3/2017
        Version:  2.0
        Description: 
                  This file contains the PASM code defining a test arcade game
}}

CON
  ' Clock settings
  _clkmode = xtal1 + pll16x     ' Standard clock mode w/ 16x PLL
  _xinfreq = 5_000_000          ' 5 MHz clock for x16 = 80 MHz

OBJ
  input         : "input"       ' Import input system
  vga_display   : "vga_display" ' Import VGA display system
  
VAR
  ' Graphic resources pointers
  long  tile_map_base_          ' Register pointing to base of tile maps
  long  tile_palette_base_      ' Register pointing to base of tile palettes
  long  color_palette_base_     ' Register pointing to base of color palettes

  ' Game resource pointers
  long  input_state_base_       ' Register in Main RAM containing state of inputs

PUB main | started
  tile_map_base_ := @tile_maps                          ' Point tile map base to base of tile maps
  tile_palette_base_ := @tile_palettes                  ' Point tile palette base to base of tile palettes
  color_palette_base_ := @color_palettes                ' Point color palette base to base of color palettes
  input_state_base_ := @input_states                    ' Point input stat base to base of input states
                           
  vga_display.start(@tile_map_base_)                    ' Start graphics engine
  input.start(@input_state_base_)                       ' Start input system                        
      
DAT
tile_maps
              ' column     0      1      2      3      4      5      6      7      8      9      10     11     12     13     14     15     16     17     18     19     20     21     22     23     24     25     26     27      28     29     30     31                
tile_map      word      $00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 0
              word      $00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 1
              word      $00_01,$00_02,$01_01,$01_01,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$00_00,$01_01,$01_01,$01_01,$00_01,$00_02,$00_01,$00_02,$01_01,$01_01,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$00_00,$01_01,$01_01,$01_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 2
              word      $00_04,$00_03,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_04,$00_03,$00_04,$00_03,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_04,$00_03,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 3
              word      $00_01,$00_02,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$00_00,$01_01,$00_00,$00_00,$00_01,$00_02,$00_01,$00_02,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$00_00,$01_01,$00_00,$00_00,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 4
              word      $00_04,$00_03,$01_01,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$01_01,$00_00,$01_01,$01_01,$00_00,$00_04,$00_03,$00_04,$00_03,$01_01,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$01_01,$00_00,$01_01,$01_01,$00_00,$00_04,$00_03,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 5
              word      $00_01,$00_02,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_01,$00_02,$00_01,$00_02,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 6
              word      $00_04,$00_03,$01_01,$00_00,$01_01,$01_01,$00_00,$01_01,$01_01,$00_00,$00_00,$01_01,$00_00,$01_01,$00_04,$00_03,$00_04,$00_03,$01_01,$00_00,$01_01,$01_01,$00_00,$01_01,$01_01,$00_00,$00_00,$01_01,$00_00,$01_01,$00_04,$00_03,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 7
              word      $00_01,$00_02,$01_01,$01_01,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$01_01,$00_00,$01_01,$00_01,$00_01,$00_02,$01_01,$01_01,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$01_01,$00_00,$01_01,$00_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 8
              word      $00_04,$00_03,$00_00,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$00_01,$00_04,$00_03,$00_00,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$00_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 9
              word      $00_01,$00_02,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_01,$00_01,$00_02,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 10
              word      $00_04,$00_03,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_01,$00_04,$00_03,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 11
              word      $00_01,$00_02,$01_01,$01_01,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$00_00,$01_01,$01_01,$01_01,$00_01,$00_02,$00_01,$00_02,$01_01,$01_01,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$00_00,$01_01,$01_01,$01_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 12
              word      $00_04,$00_03,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_04,$00_03,$00_04,$00_03,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_04,$00_03,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 13
              word      $00_01,$00_02,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$00_00,$01_01,$00_00,$00_00,$00_01,$00_02,$00_01,$00_02,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$00_00,$01_01,$00_00,$00_00,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 14
              word      $00_04,$00_03,$01_01,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$01_01,$00_00,$01_01,$01_01,$00_00,$00_04,$00_03,$00_04,$00_03,$01_01,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$01_01,$00_00,$01_01,$01_01,$00_00,$00_04,$00_03,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 15
              word      $00_01,$00_02,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_01,$00_02,$00_01,$00_02,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 16
              word      $00_04,$00_03,$01_01,$00_00,$01_01,$01_01,$00_00,$01_01,$01_01,$00_00,$00_00,$01_01,$00_00,$01_01,$00_04,$00_03,$00_04,$00_03,$01_01,$00_00,$01_01,$01_01,$00_00,$01_01,$01_01,$00_00,$00_00,$01_01,$00_00,$01_01,$00_04,$00_03,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 17
              word      $00_01,$00_02,$01_01,$01_01,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$01_01,$00_00,$01_01,$00_01,$00_01,$00_02,$01_01,$01_01,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$01_01,$00_00,$01_01,$00_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 18
              word      $00_04,$00_03,$00_00,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$00_01,$00_04,$00_03,$00_00,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$00_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 19
              word      $00_01,$00_02,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_01,$00_01,$00_02,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 20
              word      $00_04,$00_03,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_01,$00_04,$00_03,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 21                            
              word      $00_01,$00_02,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_01,$00_02,$00_01,$00_02,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 22
              word      $00_04,$00_03,$01_01,$00_00,$01_01,$01_01,$00_00,$01_01,$01_01,$00_00,$00_00,$01_01,$00_00,$01_01,$00_04,$00_03,$00_04,$00_03,$01_01,$00_00,$01_01,$01_01,$00_00,$01_01,$01_01,$00_00,$00_00,$01_01,$00_00,$01_01,$00_04,$00_03,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 23
              word      $00_01,$00_02,$01_01,$01_01,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$01_01,$00_00,$01_01,$00_01,$00_01,$00_02,$01_01,$01_01,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$01_01,$00_00,$01_01,$00_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 24
              word      $00_04,$00_03,$00_00,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$00_01,$00_04,$00_03,$00_00,$01_01,$00_00,$01_01,$01_01,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$01_01,$00_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 25
              word      $00_01,$00_02,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_01,$00_01,$00_02,$00_00,$01_01,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_00,$00_00,$01_01,$00_00,$00_00,$00_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 26
              word      $00_04,$00_03,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_01,$00_04,$00_03,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_00,$00_01,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 28
              word      $00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 27 
              word      $00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_04,$00_03,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02,$00_01,$00_02                 ' row 29
tile_palettes
              ' empty tile
tile_blank    word      %%1_0_0_0_0_2_0_0                       ' tile 0
              word      %%0_0_0_0_3_0_0_0
              word      %%0_2_0_0_0_0_0_3
              word      %%0_0_0_0_0_0_0_0
              word      %%0_0_0_2_0_0_0_0
              word      %%0_0_0_0_0_0_0_0
              word      %%0_1_0_0_0_0_0_0
              word      %%0_0_0_0_2_0_0_0

              ' upper left corner of box
tile_box_tl   word      %%1_1_1_1_1_1_1_1                       ' tile 1
              word      %%3_3_3_3_3_3_3_1
              word      %%3_3_3_3_3_3_3_1
              word      %%3_3_3_3_3_3_3_1
              word      %%3_3_3_3_3_3_3_1
              word      %%3_3_3_3_3_3_3_1
              word      %%3_3_3_3_3_3_3_1
              word      %%3_3_3_3_3_3_3_1

              ' upper right corner of box
tile_box_tr   word      %%1_1_1_1_1_1_1_1                       ' tile 2
              word      %%1_3_3_3_3_3_3_3
              word      %%1_3_3_3_3_3_3_3
              word      %%1_3_3_3_3_3_3_3
              word      %%1_3_3_3_3_3_3_3
              word      %%1_3_3_3_3_3_3_3
              word      %%1_3_3_3_3_3_3_3
              word      %%1_3_3_3_3_3_3_3

              ' bottom right corner of box
tile_box_br   word      %%1_3_3_3_3_3_3_3                       ' tile 3
              word      %%1_3_3_3_3_3_3_3
              word      %%1_3_3_3_3_3_3_3
              word      %%1_3_3_3_3_3_3_3
              word      %%1_3_3_3_3_3_3_3
              word      %%1_3_3_3_3_3_3_3
              word      %%1_3_3_3_3_3_3_3
              word      %%1_1_1_1_1_1_1_1

              ' bottom left corner of box
tile_box_bl   word      %%3_3_3_3_3_3_3_1                       ' tile 4
              word      %%3_3_3_3_3_3_3_1
              word      %%3_3_3_3_3_3_3_1
              word      %%3_3_3_3_3_3_3_1
              word      %%3_3_3_3_3_3_3_1
              word      %%3_3_3_3_3_3_3_1
              word      %%3_3_3_3_3_3_3_1
              word      %%1_1_1_1_1_1_1_1

color_palettes
              ' Test palettes
c_palette1    long      %11000011_00110011_00011111_00000011                    ' palette 0
c_palette2    long      %00000011_00110011_11111111_11000011                    ' palette 1

input_states
              ' Input states
control_state word      0       ' Control states
tilt_state    word      0       ' Tilt shift state
       